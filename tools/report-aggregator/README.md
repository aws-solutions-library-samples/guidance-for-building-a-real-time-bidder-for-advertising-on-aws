# Report aggregator

Report aggregator is a tool for aggregating reports generated by load generators.

# Building docker image

From the project root directory, run

```shell
make report-aggregator@build
```

This will build a docker image with report generator.

# Running report aggregator

Report aggregator can be use to aggregate report in few scenarios.

## Locally aggregate report files

To aggregate report from local files pass the paths using `--file` argument.

```shell
go run . --file report1.json --file report2.json
```

## Locally aggregate reports from load generators from K8s

To aggregate report from K8s cluster locally, pass `--kubeconfig`, `--job` and optionally `--namespace` arguments.
Ensure that `kubectl` is configured with K8s cluster that you going to use.  

```shell
go run . --kubeconfig ~/.kube/config --job load-generator
```

## Aggregate reports in K8s cluster

To run report aggregator in K8s cluster, pass `--job` and optionally `--namespace` arguments.

Ensure that the pod has been granted to use K8s API:
 * resource: `pods`, `pods/log`, `job`
 * verbs: `get`, `list

# Report aggregator parameters

List of available arguments/environment variables:

| Argument                | Env                            | Default Value     | Description                                                
| ------------------------|--------------------------------| ------------------|-------------------------------
| `--job name`            | `REPORT_AGGREGATOR_JOB`        |                   | load generator job name                            
| `--namespace name`      | `REPORT_AGGREGATOR_NAMESPACE`  | `default`         | K8S namespace for specified job                              
| `--file filename`       | `REPORT_AGGREGATOR_FILE`       |                   | array of local files with load generator reports                              
| `--kubeconfig filename` | `REPORT_AGGREGATOR_KUBECONFIG` |                   | path to `kubeconfig` (eg. `~/.kube/config`)                               
